<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Key Programmatic Issues</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="container mx-auto p-4">
        <!-- Section 8: Key Programmatic Issues -->
        <div id="section8" class="section bg-white p-6 rounded-lg shadow-md mb-4">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-bold text-blue-600 mb-4">Key Programmatic Issues</h2>
                <p class="text-gray-600 mb-4">Identify and add key programmatic issues that require intervention.</p>
                <div id="warning-message" class="text-center bg-yellow-50 p-4 rounded-md border border-yellow-300">
                    <p class="text-yellow-600 font-medium">No Key Programmatic Issues Added</p>
                    <button id="add-issue-btn" class="mt-3 px-6 py-2 bg-blue-100 text-blue-600 font-semibold rounded hover:bg-blue-200">
                        + Add Issue
                    </button>
                </div>
            </div>

            <!-- Issue Form -->
            <form id="issue-form" class="hidden bg-gray-50 p-4 rounded-md border border-gray-300 mb-6">
                <h4 class="text-lg font-semibold mb-4 text-blue-600">Add New Issue</h4>
                <label class="block mb-2">
                    Major Findings:
                    <input type="text" id="major-findings" class="w-full p-3 border rounded-md" minlength="2" maxlength="200" required />
                </label>
                <label class="block mb-2">
                    Interventions/Activities Identified:
                    <input type="text" id="interventions" class="w-full p-3 border rounded-md" minlength="2" maxlength="200" required />
                </label>
                <label class="block mb-2">
                    Level of Intervention:
                    <input type="text" id="intervention-level" class="w-full p-3 border rounded-md" minlength="2" maxlength="200" required />
                </label>
                <label class="block mb-2">
                    Responsibility:
                    <input type="text" id="responsibility" class="w-full p-3 border rounded-md" minlength="2" maxlength="200" required />
                </label>
                <label class="block mb-2">
                    Timeline:
                    <input type="text" id="timeline" class="w-full p-3 border rounded-md" minlength="2" maxlength="200" required />
                </label>
                <div class="flex justify-end space-x-4 mt-4">
                    <button type="button" id="cancel-btn" class="px-4 py-2 bg-gray-100 rounded hover:bg-gray-200">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add Issue</button>
                </div>
            </form>

            <!-- Add Another Issue Button -->
            <div id="add-another-issue-btn-container" class="hidden text-center mb-6">
                <button id="add-another-issue-btn" class="px-6 py-2 bg-blue-100 text-blue-600 font-semibold rounded hover:bg-blue-200">
                    + Add Another Issue
                </button>
            </div>

            <!-- Issues List -->
            <ul id="issue-list" class="space-y-4"></ul>

            <!-- Submit Button -->
            <div class="flex justify-end mt-6">
                <button id="submit-btn" class="px-6 py-3 bg-green-500 text-white font-semibold rounded hover:bg-green-600">
                    Submit
                </button>
            </div>
        </div>
    </div>

    <script>
        let issueCount = 0;
        const maxIssues = 3;

        document.getElementById('add-issue-btn').addEventListener('click', () => {
            if (issueCount >= maxIssues) {
                alert('You can only add up to 3 issues.');
                return;
            }
            document.getElementById('issue-form').classList.remove('hidden');
            document.getElementById('add-issue-btn').classList.add('hidden');
        });

        document.getElementById('issue-form').addEventListener('submit', (event) => {
            event.preventDefault();

            const majorFindings = document.getElementById('major-findings').value.trim();
            const interventions = document.getElementById('interventions').value.trim();
            const interventionLevel = document.getElementById('intervention-level').value.trim();
            const responsibility = document.getElementById('responsibility').value.trim();
            const timeline = document.getElementById('timeline').value.trim();

            if (!majorFindings || !interventions || !interventionLevel || !responsibility || !timeline) {
                alert('All fields are required.');
                return;
            }

            const issueList = document.getElementById('issue-list');
            const listItem = document.createElement('li');
            listItem.className = 'p-4 bg-white border rounded-md shadow-md flex justify-between items-center';

            listItem.innerHTML = `
                <div>
                    <strong>Major Findings:</strong> ${majorFindings}<br>
                    <strong>Interventions:</strong> ${interventions}<br>
                    <strong>Level of Intervention:</strong> ${interventionLevel}<br>
                    <strong>Responsibility:</strong> ${responsibility}<br>
                    <strong>Timeline:</strong> ${timeline}
                </div>
                <button onclick="deleteIssue(this)" class="text-red-500 font-semibold hover:underline">Delete</button>
            `;

            issueList.appendChild(listItem);
            issueCount++;

            // Reset and hide the form
            document.getElementById('issue-form').reset();
            document.getElementById('issue-form').classList.add('hidden');

            // Update visibility of buttons and warning message
            document.getElementById('add-another-issue-btn-container').classList.remove('hidden');
            if (issueCount === maxIssues) {
                document.getElementById('add-another-issue-btn-container').classList.add('hidden');
            }
            document.getElementById('warning-message').classList.add('hidden');
        });

        document.getElementById('cancel-btn').addEventListener('click', () => {
            document.getElementById('issue-form').classList.add('hidden');
            if (issueCount === 0) {
                document.getElementById('add-issue-btn').classList.remove('hidden');
            } else {
                document.getElementById('add-another-issue-btn-container').classList.remove('hidden');
            }
        });

        document.getElementById('add-another-issue-btn').addEventListener('click', () => {
            if (issueCount >= maxIssues) {
                alert('You can only add up to 3 issues.');
                return;
            }
            document.getElementById('issue-form').classList.remove('hidden');
            document.getElementById('add-another-issue-btn-container').classList.add('hidden');
        });

        function deleteIssue(button) {
            const listItem = button.parentElement;
            listItem.remove();
            issueCount--;

            // Show warning message and Add Issue button if no issues are left
            if (issueCount === 0) {
                document.getElementById('warning-message').classList.remove('hidden');
                document.getElementById('add-issue-btn').classList.remove('hidden');
            } else if (issueCount < maxIssues) {
                document.getElementById('add-another-issue-btn-container').classList.remove('hidden');
            }
        }

        document.getElementById('submit-btn').addEventListener('click', () => {
            if (issueCount === 0) {
                alert('Please add at least one issue before submitting.');
                return;
            }

            alert('Form submitted successfully!');
            
        });
        document.querySelector('.submit').addEventListener('click', event => {
         event.preventDefault();
          if (validations.section5()) {
            const formData = {
                areasOfIssue: [],
                details: {
                    knowledgeIssue: document.getElementById('knowledgeIssue')?.value || "",
                    knowledgeAction: document.getElementById('knowledgeAction')?.value || ""
                }
            };
            fetch('https://your-backend-api.com/submit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
                .then(response => response.json())
                .then(data => alert("Submission Successful"))
                .catch(error => alert("Submission Failed"));
        }
});
    </script>
</body>

</html>
